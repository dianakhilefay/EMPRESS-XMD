// Environment variables with fallback values
const BOT_NAME = process.env.BOT_NAME || "á´á´€ÊŸá´ ÉªÉ´ - ÊŸÉªá´›á´‡";
const OWNER_NAME = process.env.OWNER_NAME || "á´á´€ÊŸá´ ÉªÉ´ á´‹ÉªÉ´É¢";
const REPO_LINK = process.env.REPO_LINK || "https://github.com/XdKing2/MALVIN-XD";
const MENU_IMAGE_URL = process.env.MENU_IMAGE_URL || "https://files.catbox.moe/x7qky4.jpg";
const fakevCard = require('../lib/fakevcard');

module.exports = {
    pattern: 'menu',
    alias: ['help', 'm'],
    category: 'utility',
    desc: 'Show bot menu with all commands',
    react: 'ğŸ“‹',
    filename: __filename,
    use: '.menu',
    
    execute: async (conn, mek, m, { from, args, reply, userPrefix, sessionId }) => {
        try {
            // Get variables from global scope
            const activeSockets = global.activeSockets || new Map();
            const commands = global.commands || new Map();
            
            const menu = generateMenu(userPrefix, sessionId, activeSockets, commands);
            
            // Send menu with newsletter forwarding
            await conn.sendMessage(from, {
                text: menu,
                contextInfo: {
                    forwardingScore: 999,
                    isForwarded: true,
                    forwardedNewsletterMessageInfo: {
                        newsletterJid: "120363402507750390@newsletter",
                        newsletterName: "á´á´€ÊŸá´ ÉªÉ´ á´›á´‡á´„ÊœğŸª€",
                        serverMessageId: 200
                    },
                    externalAdReply: {
                        title: "ğŸ”® á´„á´á´… á´á´‡É´á´œ",
                        body: `${BOT_NAME} - á´€ÊŸÊŸ á´„á´á´…s`,
                        thumbnailUrl: MENU_IMAGE_URL,
                        sourceUrl: REPO_LINK,
                        mediaType: 1,
                        renderLargerThumbnail: true
                    }
                }
            }, { quoted: fakevCard });
            
        } catch (error) {
            console.error('Menu command error:', error);
            return reply('âŒ An error occurred while generating the menu. Please try again later.');
        }
    }
};

// Generate menu function
function generateMenu(userPrefix, sessionId, activeSockets, commands) {
    // Calculate uptime
    const uptime = process.uptime();
    const hours = Math.floor(uptime / 3600);
    const minutes = Math.floor((uptime % 3600) / 60);
    const uptimeStr = `${hours} hour, ${minutes} minutes`;

    // Get active sessions count
    const activeSessions = activeSockets ? activeSockets.size : 1;

    // Count total commands (more accurate count)
    let totalCommands = 0;
    for (const [pattern, command] of commands.entries()) {
        totalCommands++;
    }
    // Use the actual loaded commands count instead of adding arbitrary number

    const menuText = `*â”â”€â”€â”€â”€ã€˜ ${BOT_NAME} ã€™â”€â”€â”€âŠ·*
*â”ƒ  Owner:* ${OWNER_NAME}
*â”ƒ  Prefix:* ${userPrefix}
*â”ƒ  Version:* 1.0.0 Beta
*â”ƒ  Platform:* Node.js
*â”ƒ  Total Commands:* ${totalCommands}
*â”ƒ  Runtime:* ${uptimeStr}
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘ªğ’ğ’“ğ’† ğ‘ªğ’ğ’ğ’ğ’‚ğ’ğ’…ğ’” ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´˜ÉªÉ´É¢*
*â”ƒ 2.  á´á´‡É´á´œ*
*â”ƒ 3.  Ê€á´œÉ´á´›Éªá´á´‡*
*â”ƒ 4.  á´˜Ê€á´‡êœ°Éªx*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘¨ğ‘° ğ‘ªğ’ğ’ğ’ğ’‚ğ’ğ’…ğ’” ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  êœ°ÊŸá´œxá´€Éª*
*â”ƒ 2.  É¢á´˜á´›4*
*â”ƒ 3.  ÊŸá´œá´ÉªÉ´á´€Éª*
*â”ƒ 4.  á´á´‡á´›á´€á´€Éª*
*â”ƒ 5.  á´€Éªá´„ÊŸá´€á´œá´…á´‡*
*â”ƒ 6.  sá´œÉ´á´*
*â”ƒ 7.  á´€Éªá´á´œsÉªá´„*
*â”ƒ 8.  á´„Êœá´€á´›É¢á´˜á´›*
*â”ƒ 9.  á´€ÉªÊŸá´€Ê™s*
*â”ƒ 10. á´€Ê€á´›ÊŸÊ*
*â”ƒ 11. á´ á´‡á´*
*â”ƒ 12. á´›á´êœ°ÉªÉ¢á´œÊ€á´‡*
*â”ƒ 13. á´€Éªá´„Êœá´€á´›*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘«ğ’ğ’˜ğ’ğ’ğ’ğ’‚ğ’…ğ’†ğ’“ ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´˜ÊŸá´€Ê*
*â”ƒ 2.  Êá´á´œá´›á´œÊ™á´‡*
*â”ƒ 3.  ÉªÉ´sá´›á´€É¢Ê€á´€á´*
*â”ƒ 4.  êœ°á´€á´„á´‡Ê™á´á´á´‹*
*â”ƒ 5.  á´›Éªá´‹á´›á´á´‹*
*â”ƒ 6.  á´›á´¡Éªá´›á´›á´‡Ê€*
*â”ƒ 7.  á´˜ÉªÉ´á´›á´‡Ê€á´‡sá´›*
*â”ƒ 8.  á´€á´˜á´‹*
*â”ƒ 9.  á´á´á´…á´€á´˜á´‹*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘®ğ’“ğ’ğ’–ğ’‘ ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´›á´€É¢á´€ÊŸÊŸ*
*â”ƒ 2.  á´‹Éªá´„á´‹*
*â”ƒ 3.  á´˜Ê€á´á´á´á´›á´‡*
*â”ƒ 4.  á´…á´‡á´á´á´›á´‡*
*â”ƒ 5.  ÊœÉªá´…á´‡á´›á´€É¢*
*â”ƒ 6.  ÉªÉ´á´ Éªá´›á´‡*
*â”ƒ 7.  á´Šá´ÉªÉ´*
*â”ƒ 8.  ÊŸÉªsá´›á´É´ÊŸÉªÉ´á´‡*
*â”ƒ 9.  á´›á´€É¢á´€á´…á´ÉªÉ´s*
*â”ƒ 10. á´„Ê€á´‡á´€á´›á´‡É¢Ê€á´á´œá´˜*
*â”ƒ 11. á´á´œá´›á´‡*
*â”ƒ 12. á´á´˜á´‡É´*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘­ğ’–ğ’ ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  Ê™Ê€á´€á´›á´ Éªá´…*
*â”ƒ 2.  Ê™Ê€á´€á´›2*
*â”ƒ 3.  á´Šá´á´‹á´‡*
*â”ƒ 4.  êœ°ÊŸÉªÊ€á´›*
*â”ƒ 5.  á´›Ê€á´œá´›Êœ*
*â”ƒ 6.  á´…á´€Ê€á´‡*
*â”ƒ 7.  êœ°á´€á´„á´›*
*â”ƒ 8.  á´˜Éªá´„á´‹á´œá´˜ÊŸÉªÉ´á´‡*
*â”ƒ 9.  á´„Êœá´€Ê€á´€á´„á´›á´‡Ê€*
*â”ƒ 10. Ê€á´‡á´˜á´‡á´€á´›*
*â”ƒ 11. êœ°êœ°á´„Êœá´€Ê€*
*â”ƒ 12. êœ°êœ°sá´‡á´›á´›ÉªÉ´É¢s*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘ºğ’•ğ’Šğ’„ğ’Œğ’†ğ’“ ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  sá´›Éªá´„á´‹á´‡Ê€*
*â”ƒ 2.  Ç«á´„*
*â”ƒ 3.  á´ á´ *
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘³ğ’ğ’ˆğ’ ğ‘´ğ’‚ğ’Œğ’†ğ’“ ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  3á´…á´„á´á´Éªá´„*
*â”ƒ 2.  3á´…á´˜á´€á´˜á´‡Ê€*
*â”ƒ 3.  á´€á´á´‡Ê€Éªá´„á´€*
*â”ƒ 4.  á´€É´É¢á´‡ÊŸá´¡ÉªÉ´É¢s*
*â”ƒ 5.  Ê™á´‡á´€Ê€*
*â”ƒ 6.  Ê™ÉªÊ€á´›Êœá´…á´€Ê*
*â”ƒ 7.  Ê™ÊŸá´€á´„á´‹á´˜ÉªÉ´á´‹*
*â”ƒ 8.  Ê™á´á´á´*
*â”ƒ 9.  Ê™á´œÊŸÊ™*
*â”ƒ 10. á´„á´€sá´›ÊŸá´‡*
*â”ƒ 11. á´„á´€á´›*
*â”ƒ 12. á´„ÊŸá´á´œá´…s*
*â”ƒ 13. á´…á´‡á´€á´…á´˜á´á´ÊŸ*
*â”ƒ 14. á´…á´‡á´ ÉªÊŸá´¡ÉªÉ´É¢s*
*â”ƒ 15. á´…Ê€á´€É¢á´É´Ê™á´€ÊŸÊŸ*
*â”ƒ 16. á´‡Ê€á´€sá´‡Ê€*
*â”ƒ 17. êœ°Ê€á´á´¢á´‡É´*
*â”ƒ 18. êœ°á´œá´›á´œÊ€Éªsá´›Éªá´„*
*â”ƒ 19. É¢ÊŸá´ssÊsÉªÊŸá´ á´‡Ê€*
*â”ƒ 20. Êœá´€á´„á´‹á´‡Ê€*
*â”ƒ 21. ÊŸá´‡á´€êœ°*
*â”ƒ 22. ÊŸá´œxá´œÊ€Ê*
*â”ƒ 23. É´á´‡á´É´ÊŸÉªÉ¢Êœá´›*
*â”ƒ 24. É´ÉªÉ¢á´‡Ê€Éªá´€*
*â”ƒ 25. á´˜á´€ÉªÉ´á´›*
*â”ƒ 26. á´˜á´Ê€É´Êœá´œÊ™*
*â”ƒ 27. sá´€á´…É¢ÉªÊ€ÊŸ*
*â”ƒ 28. sá´€É´s*
*â”ƒ 29. sá´œÉ´sá´‡á´›*
*â”ƒ 30. á´›á´€á´›á´á´*
*â”ƒ 31. á´›á´‡xá´›á´á´€á´‹á´‡Ê€*
*â”ƒ 32. á´›Êœá´Ê€*
*â”ƒ 33. á´¢á´á´…Éªá´€á´„*
*â”ƒ 34. Êá´›ÊŸá´É¢á´*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘ºğ’•ğ’‚ğ’ğ’Œğ’Šğ’ğ’ˆ ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´¡á´€sá´›á´€ÊŸá´‹*
*â”ƒ 2.  xsá´›á´€ÊŸá´‹*
*â”ƒ 3.  á´›Éªá´‹á´›á´á´‹sá´›á´€ÊŸá´‹*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘»ğ’ğ’ğ’ğ’” ğ‘´ğ’†ğ’ğ’– ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´›Ê€á´€É´sÊŸá´€á´›á´‡*
*â”ƒ 2.  sá´„Ê€á´‡á´‡É´sÊœá´á´›*
*â”ƒ 3.  É¢á´á´€ÉªÊŸá´˜Ê€á´êœ°ÉªÊŸá´‡*
*â”ƒ 4.  á´œá´˜sá´„á´€ÊŸá´‡-Éªá´á´€É¢á´‡2*
*â”ƒ 5.  Ê€á´‡á´á´á´ á´‡Ê™É¢*
*â”ƒ 6.  sÊœá´Ê€á´›á´œÊ€ÊŸ*
*â”ƒ 7.  á´›á´‡ÊŸá´‡É¢Ê€á´€á´-sá´‡á´€Ê€á´„Êœ*
*â”ƒ 8.  á´á´á´…á´…á´‡á´›á´€ÉªÊŸ*
*â”ƒ 9.  á´á´€á´˜s*
*â”ƒ 10. á´œÊ€ÊŸ3*
*â”ƒ 11. á´˜á´˜á´„á´á´œá´˜ÊŸá´‡*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘¨ğ’–ğ’…ğ’Šğ’/ğ‘½ğ’Šğ’…ğ’†ğ’ ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´›á´á´€á´œá´…Éªá´*
*â”ƒ 2.  á´›á´á´ É´*
*â”ƒ 3.  á´„Êœá´á´˜3*
*â”ƒ 4.  ÊŸÊÊ€Éªá´„*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘°ğ’ğ’‚ğ’ˆğ’† ğ‘»ğ’ğ’ğ’ğ’” ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  4á´‹á´¡á´€ÊŸÊŸá´˜á´€á´˜á´‡Ê€*
*â”ƒ 2.  êœ°á´€á´‹á´‡á´„á´€ÊŸÊŸ*
*â”ƒ 3.  êœ°á´€á´‹á´‡á´¡á´€*
*â”ƒ 4.  sá´€á´ á´‡*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*â”â”€â”€â”€â”€ã€˜ ğ‘¶á­™êª€ê«€ğ˜³ ğ‘´ê«€êª€êªŠ ã€™â”€â”€â”€âŠ·*
*â”ƒ 1.  á´á´¡É´á´‡Ê€*
*â”ƒ 2.  sá´‡É´á´…*
*â”ƒ 3.  É¢Éªá´›á´„ÊŸá´É´á´‡*
*â”—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŠ·*

*âš¡ Powered by ${BOT_NAME}*`;

    return menuText;
}